<!DOCTYPE html>
<html>
<head>
  <title>Story Editor</title>
  <style>
    /* General Styles */
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
    }

    .container {
      display: flex;
      flex-direction: column;
    }

    .sidebar {
      width: 100%;
      background-color: #333333;
      color: #ffffff;
      padding: 20px;
      display: flex;
      align-items: center;
    }

    .image-placeholder {
      width: 50px;
      height: 50px;
      background-color: #333333;
      margin-right: 20px;
    }

    .button-container {
      display: flex;
    }

    .main-content {
      padding: 20px;
    }

    h1, h2 {
      color: #333;
    }

    /* Form Styles */
    form {
      max-width: 600px;
      margin: 0 auto;
    }

    label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
    }

    input[type="text"],
    input[type="color"],
    textarea {
      width: 100%;
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 4px;
      box-sizing: border-box;
      margin-bottom: 10px;
    }

    input[type="color"] {
      width: 40px;
      height: 40px;
      padding: 0;
    }

    textarea {
      height: 150px;
    }

    /* Styles for story name and start room inputs */
    #storyName,
    #startRoom {
      max-width: 300px;
    }

    /* Button Styles */
    button {
      padding: 10px 20px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      margin-right: 10px;
      margin-bottom: 10px;
      font-size: 14px;
    }

    button.add-exit {
      background-color: #007bff;
      color: #ffffff;
    }

    button.add-exit:hover {
      background-color: #0056b3;
    }

    button.remove-room {
      background-color: #dc3545;
      color: #ffffff;
    }

    button.remove-room:hover {
      background-color: #c82333;
    }

    button#addRoomButton {
      background-color: #28a745;
      color: #ffffff;
    }

    button#addRoomButton:hover {
      background-color: #1e7e34;
    }

    /* Room Container Styles */
    .room-container {
      display: flex;
      margin-bottom: 20px;
    }

    .room-container:nth-child(odd) {
      flex-direction: row;
    }

    .room-container:nth-child(even) {
      flex-direction: row-reverse;
    }

    .room-sidebar {
     width: 40px;
     height: 360px;
     background-color: #000;
     color: #fff;
     display: flex;
     font-size: 26px;
     align-items: center;
     justify-content: flex-start; /* Align text to the left side */
     font-weight: bold;
     padding: 10px;
     box-sizing: border-box;
     letter-spacing: 2px;
     writing-mode: vertical-rl;
     text-orientation: mixed;
    }

    .room-content {
      flex: 1;
      padding: 20px;
      background-color: #f0f0f0;
    }

    .room-buttons {
      display: flex;
      justify-content: flex-end;
      margin-top: 10px;
    }

    .room-buttons button {
      margin-left: 10px;
    }

    .room-image-preview {
      margin-top: 10px;
    }

    .room-image-preview img {
      max-width: 100%;
      max-height: 200px;
    }

    .exits-container {
      margin-top: 10px;
    }

    .exit-container,
    .skill-check-container {
      margin-bottom: 10px;
      padding: 10px;
      background-color: #e4e4e4;
    }

    .mode-toggle {
      position: absolute;
      top: 20px;
      right: 20px;
      display: flex;
      align-items: center;
    }

    .mode-toggle label {
      display: flex;
      align-items: center;
      margin-left: 10px;
      cursor: pointer;
    }

    .mode-toggle-text {
      margin-left: 5px;
      color: #adadad;
      transition: color 0.5s ease;
    }

    body.light-mode {
      background-color: #fff;
    }

    body.light-mode h1,
    body.light-mode h2,
    body.light-mode label {
      color: #333;
    }

    body.light-mode .room-container {
      background-color: #f0f0f0;
    }

    body.light-mode .mode-toggle-text {
      color: #333;
    }

    @font-face {
      font-family: 'OpenDyslexic';
      src: url('/fonts/OpenDyslexic3-Regular.ttf') format('truetype');
      font-weight: normal;
      font-style: normal;
    }

    @font-face {
      font-family: 'OpenDyslexic';
      src: url('/fonts/OpenDyslexic3-Bold.ttf') format('truetype');
      font-weight: bold;
      font-style: normal;
    }

    body.dyslexic-font {
      font-family: 'OpenDyslexic', Arial, sans-serif;
    }

    body.dyslexic-font input,
    body.dyslexic-font textarea,
    body.dyslexic-font button,
    body.dyslexic-font .mode-toggle-text {
      font-family: 'OpenDyslexic', Arial, sans-serif;
    }

    #userManualContainer {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background-color: rgba(255, 255, 255, 0.9);
      padding: 20px;
      max-width: 800px;
      z-index: 1;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
      display: none;
      max-height: 80vh;
      overflow-y: auto;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="sidebar">
      <div class="image-placeholder"></div>
      <div class="button-container">
        <button type="button" id="newStoryButton">New Story</button>
        <button type="button" id="loadStoryButton">Load Story</button>
        <button type="submit" id="saveStoryButton">Save Story</button>
        <button type="button" id="flowchartButton">Flowchart</button>
        <button type="button" id="helpButton">Help</button>
      </div>
    </div>

    <div class="main-content">
      <h1>Story Editor (beta)</h1>

      <form id="storyForm">
        <label for="storyName">Story Name:</label>
        <input type="text" id="storyName" name="storyName" required maxlength="25" pattern="[^\s]+" title="No spaces allowed. Spaces will be replaced with underscores.">

        <label for="buttonColor">Button theme:</label>
        <input type="color" id="buttonColor" name="buttonColor">

        <label for="startRoom">Start Room:</label>
        <input type="text" id="startRoom" name="startRoom" required maxlength="25" pattern="[^\s]+" title="No spaces allowed. Spaces will be replaced with underscores.">

        <h2>Rooms</h2>
        <div id="roomsContainer">
          <!-- Room inputs will be dynamically added here -->
        </div>
        <button type="button" id="addRoomButton">Add Room</button>
      </form>
    </div>

    <div class="mode-toggle">
      <label>
        <input type="checkbox" id="dyslexic-toggle-checkbox">
        <span class="mode-toggle-text">Dyslexic Font</span>
      </label>
    </div>

    <div id="userManualContainer">
      <pre>
**Creating a New Story**
------------------------

1.  Click the "New Story" button in the sidebar.
2.  Enter a name for your story in the "Story Name" field.
3.  (Optional) Select a color for the button theme using the "Button theme" color picker.
4.  Enter the name of the starting room in the "Start Room" field.

**Adding Rooms**
----------------

1.  Click the "Add Room" button to create a new room.
2.  Enter the room name in the "Room Name" field.
3.  Provide a description for the room in the "Room Description" textarea.
4.  (Optional) Click the "Room Image" file input to upload an image for the room.

**Adding Exits**
----------------

1.  In the room you want to add an exit to, click the "Add Exit" button.
2.  Enter the name of the exit in the "Exit Name" field.
3.  If the exit leads to another room without a skill check, enter the name of the destination room in the "Exit Destination" field.
4.  If the exit requires a skill check, click the "Add Skill Check" button.

    *   Enter the dice type (e.g., "1d20") in the "Skill Check Dice Type" field.

    *   Enter the target value for the skill check in the "Skill Check Target" field.

    *   Provide a description for the success scenario in the "Success Description" textarea.

    *   Enter the name of the room to go to on success in the "Success Room" field.

    *   Provide a description for the failure scenario in the "Failure Description" textarea.

    *   Enter the name of the room to go to on failure in the "Failure Room" field.

**Removing Rooms**
------------------

To remove a room, click the "Remove Room" button within the room container. You'll be prompted to confirm the removal.

**Saving a Story**
------------------

1.  Click the "Save Story" button in the sidebar.
2.  The story will be saved as a ZIP file containing any room images you've included.
3.  Choose a location on your computer to save the ZIP file.

**Loading a Story**
-------------------

1.  Click the "Load Story" button in the sidebar.
2.  Select the ZIP file containing the story you want to load.
3.  The editor will populate the fields with the loaded story data.

**Generating a Flowchart**
--------------------------

1.  Click the "Flowchart" button in the sidebar.
2.  A new window will open, displaying a visual representation of the story's flow.
3.  Rooms are represented as nodes, and exits are shown as edges connecting the nodes.
4.  Skill checks are displayed as separate nodes with success and failure paths.
      </pre>
    </div>

  </div>

  <script src="main.js"></script>
  <script src="main2.js"></script>
  <script src="lib/jszip.min.js"></script>
  <script>
    // Add event listener to the new story button
    document.getElementById('newStoryButton').addEventListener('click', function() {
      const confirmNew = window.confirm('Are you sure you want to create a new story? All unsaved changes will be lost.');
      if (confirmNew) {
        // Clear the form and room containers
        document.getElementById('storyForm').reset();
        document.getElementById('roomsContainer').innerHTML = '';
      }
    });

    const modeToggleCheckbox = document.getElementById('mode-toggle-checkbox');
    const dyslexicToggleCheckbox = document.getElementById('dyslexic-toggle-checkbox');

    // Load the light mode setting from localStorage
    const isLightModeEnabled = localStorage.getItem('isLightModeEnabled') === 'true';
    modeToggleCheckbox.checked = isLightModeEnabled;
    updateMode(isLightModeEnabled);

    modeToggleCheckbox.addEventListener('change', () => {
      updateMode(modeToggleCheckbox.checked);
      // Store the light mode setting in localStorage
      localStorage.setItem('isLightModeEnabled', modeToggleCheckbox.checked);
    });

    function updateMode(isLightMode) {
      const body = document.body;
      const modeToggleText = modeToggleCheckbox.nextElementSibling;
      modeToggleText.textContent = isLightMode ? 'Dark Mode' : 'Light Mode';
      if (isLightMode) {
        body.classList.add('light-mode');
      } else {
        body.classList.remove('light-mode');
      }
    }

    // Load the dyslexic font setting from localStorage
    const isDyslexicFontEnabled = localStorage.getItem('isDyslexicFontEnabled') === 'true';
    dyslexicToggleCheckbox.checked = isDyslexicFontEnabled;
    document.body.classList.toggle('dyslexic-font', isDyslexicFontEnabled);

    dyslexicToggleCheckbox.addEventListener('change', () => {
      document.body.classList.toggle('dyslexic-font');
      // Store the dyslexic font setting in localStorage
      localStorage.setItem('isDyslexicFontEnabled', dyslexicToggleCheckbox.checked);
    });
  </script>
</body>
</html>